<!DOCTYPE html>
<html>
	<title>Income Outcomes of UMSI students by Geography and Industry</title>
	<script src="http://d3js.org/d3.v3.min.js"></script>
	<script scr="http://code.jquery.com/jquery-latest.min.js"></script>
	<link rel="stylesheet" type="text/css" href="cdo.css"/>
<head>
</head>
<body>
	<span id="geoviz"></span>
	<span id="industryviz"></span>
</body>
<script type="text/javascript">
	var width = 500;
	var height = 800;
	var padding = 100;

	var RegionByIndustry = [['Mid West', 'Startup', 5, 25000, 70000, 52008], ['West', 'Startup', 6, 77500, 110000, 97500.0], ['Mid Atlantic', 'Startup', 1, 90000, 90000, 90000], ['Mid West', 'Automotive', 8, 37200, 90000, 72200.0], ['Mid Atlantic', 'Automotive', 1, 70000, 70000, 70000], ['Mid West', 'Government', 4, 32400, 62500, 57250.0], ['West', 'Government', 2, 62500, 72500, 67500.0], ['Mid Atlantic', 'Government', 2, 40000, 65000, 52500.0], ['Mid West', 'Technology', 22, 35000, 95000, 61250.0], ['South East', 'Technology', 3, 68000, 85000, 77000], ['West', 'Technology', 31, 73000, 129000, 95000], ['North East', 'Technology', 2, 42000, 75000, 58500.0], ['South West', 'Technology', 5, 67000, 105000, 75000], ['Mid Atlantic', 'Technology', 6, 55000, 105000, 75500.0], ['International', 'Technology', 2, 82000, 150000, 116000.0], ['Mid West', 'Library', 46, 29000, 67000, 41000.0], ['South East', 'Library', 3, 30000, 42500, 41500], ['West', 'Library', 9, 38000, 54100, 42500], ['North East', 'Library', 4, 45000, 64000, 50250.0], ['South West', 'Library', 6, 36000, 48000, 42500.0], ['Mid Atlantic', 'Library', 21, 35000, 70000, 47000], ['International', 'Library', 2, 27500, 58000, 42750.0], ['Mid West', 'Consulting', 10, 37500, 120000, 70500.0], ['West', 'Consulting', 5, 70000, 88000, 77000], ['South West', 'Consulting', 2, 70000, 72000, 71000.0], ['Mid Atlantic', 'Consulting', 1, 65000, 65000, 65000], ['Mid West', 'Marketing', 5, 40000, 75000, 60000], ['West', 'Marketing', 3, 60000, 95000, 75000], ['Mid West', 'Other', 4, 42000, 150000, 49000.0], ['West', 'Other', 2, 47500, 80000, 63750.0], ['West', 'Entertainment', 4, 55000, 95000, 86500.0], ['Mid West', 'University', 16, 40000, 90000, 59500.0], ['West', 'University', 1, 80000, 80000, 80000], ['North East', 'University', 2, 60000, 75000, 67500.0], ['Mid Atlantic', 'University', 4, 20000, 91000, 58000.0], ['Mid West', 'Consumer Goods', 4, 70000, 75000, 72250.0], ['West', 'Consumer Goods', 1, 95000, 95000, 95000], ['Mid West', 'Corporate', 3, 60000, 75000, 71200], ['West', 'Corporate', 1, 75000, 75000, 75000], ['Mid West', 'Research', 2, 44352, 52500, 48426.0], ['West', 'Research', 1, 54000, 54000, 54000], ['Mid West', 'Multimedia', 8, 25000, 83200, 46500.0], ['North East', 'Multimedia', 1, 75000, 75000, 75000], ['Mid Atlantic', 'Multimedia', 1, 52000, 52000, 52000], ['Mid West', 'Healthcare', 7, 58000, 95000, 73000], ['West', 'Healthcare', 1, 70000, 70000, 70000], ['North East', 'Healthcare', 1, 75000, 75000, 75000], ['Mid Atlantic', 'Healthcare', 2, 65000, 70000, 67500.0], ['Mid West', 'Museum', 6, 30000, 40000, 33750.0], ['West', 'Museum', 1, 65000, 65000, 65000], ['Mid Atlantic', 'Museum', 1, 32500, 32500, 32500], ['Mid West', 'Environmental', 1, 48000, 48000, 48000], ['West', 'Environmental', 1, 72500, 72500, 72500], ['Mid West', 'Nonprofit', 1, 30000, 30000, 30000], ['West', 'Nonprofit', 1, 36000, 36000, 36000], ['Mid Atlantic', 'Nonprofit', 3, 50000, 70000, 58000], ['International', 'Nonprofit', 1, 65000, 65000, 65000], ['Mid West', 'Financial Services', 2, 52000, 65000, 58500.0], ['West', 'Financial Services', 2, 64000, 65000, 64500.0], ['Mid Atlantic', 'Financial Services', 4, 70000, 100000, 75000.0], ['Mid West', 'Defense', 1, 67500, 67500, 67500], ['South East', 'Defense', 1, 72000, 72000, 72000], ['West', 'Defense', 1, 65000, 65000, 65000], ['Mid Atlantic', 'Defense', 2, 101000, 110000, 105500.0], ['Mid West', 'Advertising', 8, 53000, 80000, 59250.0], ['West', 'Advertising', 2, 85000, 95000, 90000.0], ['Mid Atlantic', 'Advertising', 2, 82500, 115000, 98750.0], ['International', 'Advertising', 1, 37500, 37500, 37500]]


	var AllRegionByIndustry = [['All','Advertising',13,37500,65000,115000], ['All','Automotive',9,37200,70000,90000], ['All','Consulting',18,37500,73500,120000], ['All','Consumer Goods',5,70000,72500,95000], ['All','Corporate',4,60000,73100,75000], ['All','Defense',5,65000,72000,110000], ['All','Entertainment',4,55000,86500,95000], ['All','Environmental',2,48000,60250,72500], ['All','Financial Services',8,52000,67500,100000], ['All','Government',8,32400,62500,72500], ['All','Healthcare',11,58000,70000,95000], ['All','Library',91,27500,43000,70000], ['All','Marketing',8,40000,61250,95000], ['All','Multimedia',10,25000,50000,83200], ['All','Museum',8,30000,35000,65000], ['All','Nonprofit',6,30000,54000,70000], ['All','Other',6,42000,49000,150000], ['All','Research',3,44352,52500,54000], ['All','StartUp',12,25000,78750,110000], ['All','Technology',71,35000,80000,150000], ['All','University',23,20000,60000,91000]]; 

	var ByRegionAllIndustry = [['International','All',6,27500,61500,150000],['Mid Atlantic','All',51,20000,58000,115000],['Mid West','All',163,25000,55000,150000],['North East','All',10,42000,62000,75000],['South East','All',7,30000,68000,85000],['South West','All',13,36000,67000,105000],['West','All',75,36000,86000,129000]]

	function findMaxSalary(array) {
		var maxSalary = 0;
		for (i=0; i<array.length; i++) {
			if (array[i][5] > maxSalary) {
				maxSalary = array[i][5];
			}
		}
		return maxSalary;
	}

	function findTotalCount(array) {
		var totalCount = 0;
		for (i=0; i<array.length; i++) {
			totalCount = totalCount + array[i][2];
		}
		return totalCount;
	}

	var maxX = findMaxSalary(AllRegionByIndustry);
	var maxY = findTotalCount(AllRegionByIndustry);

	var xScaleIndustry = d3.scale.linear()
		.domain([0,maxX])
		.range([padding,(width-padding)]);

	var xScaleGeo = d3.scale.linear()
		.domain([0,maxX])
		.range([(width-padding),padding]);
		
	var yScale = d3.scale.linear()
		.domain([0,maxY])
		.range([(height-padding),padding]);
		
	var xAxisIndustry = d3.svg.axis()
		.scale(xScaleIndustry)
		.orient("bottom")
		.ticks(8);

	var xAxisGeo = d3.svg.axis()
		.scale(xScaleGeo)
		.orient("bottom")
		.ticks(8);

	var yAxisIndustry = d3.svg.axis()
		.scale(yScale)
		.orient("right")
		.ticks(20);

	var yAxisGeo = d3.svg.axis()
		.scale(yScale)
		.orient("left")
		.ticks(20);

	var color = d3.scale.ordinal()
		.domain(['International','Mid Atlantic', 'Mid West', 'North East', 'South East', 'South West', 'West', 'Advertising', 'Automotive', 'Consulting', 'Consumer Goods', 'Corporate', 'Defense', 'Entertainment', 'Environmental', 'Financial Services', 'Government', 'Healthcare', 'Library', 'Marketing', 'Multimedia', 'Museum', 'Nonprofit', 'Other', 'Research', 'Startup', 'Technology', 'University'])
		.range(['#5254a3','#8ca252', '#bd9e39', '#ad494a', ' #a55194', '#17becf', '#fb3650', '#393b79', '#5254a3', '#6b6ecf', '#9c9ede', '#637939', '#8ca252', '#b5cf6b', '#cedb9c', '#8c6d31', '#bd9e39', '#e7ba52', '#e7cb94', '#843c39', '#ad494a', '#d6616b', '#e7969c', '#7b4173', '#a55194', '#ce6dbd', '#de9ed6', '#17becf']);

	function stripArrayRegions(array, region) {
		newArray = [];
		for (i=0; i<array.length; i++) {
			if (array[i][0] == region) {
				newArray.push(array[i]);
			}
		}
		return newArray;
	}

	var MidwestByIndustries = stripArrayRegions(RegionByIndustry, "Mid West"); 

	function mintoMax(array) {
		var y1 = 0;
		var y2 = 0;
		var rangelines = [];
		for (i=0; i<array.length; i++) {
			x1 = array[i][3];
			x2 = array[i][5];
			xcircle = array[i][4];
			y1 = y2;
			y2 = y1 + array[i][2];
			y = (y1 + y2)/2; 
			geo = array[i][0];
			industry = array[i][1];
			rangelines.push({"geo":geo, "industry":industry, "xcircle":xcircle, "ycircle":y, "x1":x1, "y1":y, "x2":x2, "y2":y});
		}
		return rangelines;
	}

	function countDisplay(array) {
		var xpoint = 0;
		var y1 = 0;
		var y2 = 0;
		var countlines = [];
		for (i=0; i<array.length; i++) {
			y1 = y2;
			y2 = y1 + array[i][2];
			geo = array[i][0];
			industry = array[i][1];
			countlines.push({"geo":geo, "industry":industry, "x1":xpoint, "y1":y1, "x2":xpoint, "y2":y2});
		}
		return countlines;
	}

	function updateCharts(geoArray,industryArray) {
		var industryranges = industryCanvas.selectAll(".ranges")
			.data(mintoMax(industryArray));
		industryranges.enter().append("line")
		industryranges.transition()
			.duration(0)
			.attr("x1", function(d) {
				return xScaleIndustry(d.x1);
			})
			.attr("y1", function(d) {
				return yScale(d.y1);
			})
			.attr("x2", function(d) {
				return xScaleIndustry(d.x2);
			})
			.attr("y2", function(d) {
				return yScale(d.y2);
			})
			.attr("stroke", function(d) {
				return color(d.industry);
			})
			.attr("stroke-width",2)
			.attr("class","ranges");
		industryranges.exit().remove();

		var industrymedians = industryCanvas.selectAll("circle")
			.data(mintoMax(industryArray));
		industrymedians.enter().append("circle");
		industrymedians.transition()
			.duration(0)
			.attr("cx", function(d) {
				return xScaleIndustry(d.xcircle);
			})
			.attr("cy", function(d) {
				return yScale(d.ycircle);
			})
			.attr("r",4)
			.attr("fill", function(d) {
				return color(d.industry);});
		industrymedians.exit().remove();

		var industrycounts = industryCanvas.selectAll(".counts")
			.data(countDisplay(industryArray));
		industrycounts.enter().append("line")
		industrycounts.transition()
			.duration(0)
			.attr("x1", function(d) {
				return xScaleIndustry(d.x1);
			})
			.attr("y1", function(d) {
				return yScale(d.y1)-1;
			})
			.attr("x2", function(d) {
				return xScaleIndustry(d.x2);
			})
			.attr("y2", function(d) {
				return yScale(d.y2)+1;
			})
			.attr("stroke", function(d) {
				return color(d.industry);
			})
			.attr("stroke-width",10)
			.attr("class","counts");
		industrycounts.exit().remove();

		var industrylabels = industryCanvas.selectAll(".groupLabel")
			.data(countDisplay(industryArray));
		industrylabels.enter().append("text");
		industrylabels.transition()
			.duration(0)
			.attr("x", function(d) {
				return (xScaleIndustry(d.x1) - padding/10);
			})
			.attr("y", function(d) {
				return (yScale((d.y2+d.y1)/2) + 5);
			})
			.attr("text-anchor", "end")
			.text(function(d) {
				return d.industry;
			})
			.attr("class","groupLabel");
		industrylabels.exit().remove();

		//GEO
		var georanges = geoCanvas.selectAll(".ranges")
			.data(mintoMax(geoArray));
		georanges.enter().append("line")
		georanges.transition()
			.duration(0)
			.attr("x1", function(d) {
				return xScaleGeo(d.x1);
			})
			.attr("y1", function(d) {
				return yScale(d.y1);
			})
			.attr("x2", function(d) {
				return xScaleGeo(d.x2);
			})
			.attr("y2", function(d) {
				return yScale(d.y2);
			})
			.attr("stroke", function(d) {
				return color(d.geo)})
			.attr("stroke-width",2)
			.attr("class","ranges");
		georanges.exit().remove();

		var geomedians = geoCanvas.selectAll("circle")
			.data(mintoMax(geoArray));
		geomedians.enter().append("circle");
		geomedians.transition()
			.duration(0)
			.attr("cx", function(d) {
				return xScaleGeo(d.xcircle);
			})
			.attr("cy", function(d) {
				return yScale(d.ycircle);
			})
			.attr("r",4)
			.attr("fill", function(d) {
				return color(d.geo)});
		geomedians.exit().remove();

		var geocounts = geoCanvas.selectAll(".counts")
			.data(countDisplay(geoArray));
		geocounts.enter().append("line");
		geocounts.transition()
			.duration(0)
			.attr("x1", function(d) {
				return xScaleGeo(d.x1);
			})
			.attr("y1", function(d) {
				return yScale(d.y1)-1;
			})
			.attr("x2", function(d) {
				return xScaleGeo(d.x2);
			})
			.attr("y2", function(d) {
				return yScale(d.y2)+1;
			})
			.attr("stroke", function(d) {
				return color(d.geo)})
			.attr("stroke-width",10)
			.attr("class","count");
		geocounts.exit().remove();

		var geolabels = geoCanvas.selectAll(".groupLabel")
			.data(countDisplay(geoArray));
		geolabels.enter().append("text");
		geolabels.transition()
			.duration(0)
			.attr("x", function(d) {
				return (xScaleGeo(d.x1) + padding/10);
			})
			.attr("y", function(d) {
				return (yScale((d.y2+d.y1)/2) + 5);
			})
			.attr("text-anchor", "start")
			.text(function(d) {
				return d.geo;
			})
			.attr("class","groupLabel");
		geolabels.exit().remove();
	}

	var industryCanvas = d3.select("#industryviz")
		.append("svg")
		.attr("height", height)
		.attr("width", width);
	industryCanvas.append("g")
		.attr("class", "axis")
		.attr("transform", "translate("+(width-padding)+",0)")
		.call(yAxisIndustry);
	industryCanvas.append("g")
		.attr("class", "axis")
		.attr("transform", "translate(0,"+(height-padding)+")")
		.call(xAxisIndustry);

	var geoCanvas = d3.select("#geoviz")
		.append("svg")
		.attr("height", height)
		.attr("width", width);
	geoCanvas.append("g")
		.attr("class", "axis")
		.attr("transform", "translate("+padding+",0)")
		.call(yAxisGeo);
	geoCanvas.append("g")
		.attr("class", "axis")
		.attr("transform", "translate(0,"+(height-padding)+")")
		.call(xAxisGeo);

	//adding chart titles and axes titles
	geoCanvas.append("text")
		.attr("class","chartTitle")
		.attr("text-anchor", "middle")
		.attr("transform", "translate("+(width/2)+","+(padding/2)+")")
		.text("Statistics by Regions");
	geoCanvas.append("text")
		.attr("class","axisLabel")
		.attr("text-anchor","middle")
		.attr("transform", "translate("+(width/2)+","+(height-padding/2)+")")
		.text("Ranges and Medians of Salaries");
	geoCanvas.append("text")
		.attr("class","axisLabel")
		.attr("text-anchor","middle")
		.attr("transform","translate("+(padding/2)+","+(height/2)+")rotate(-90)")
		.text("Cumulative Count of Students Going to Different Regions");


	industryCanvas.append("text")
		.attr("class", "chartTitle")
		.attr("text-anchor", "middle")
		.attr("transform", "translate("+(width/2)+","+(padding/2)+")")
		.text("Statistics by Industries")

	updateCharts(ByRegionAllIndustry,AllRegionByIndustry);


    
</script>
</html>
